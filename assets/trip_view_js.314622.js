
window.Geoloqi=window.Geoloqi||{};Geoloqi.map={zoom:(Geoloqi.last&&Geoloqi.last.location)?14:2,center:{"x":(Geoloqi.last&&Geoloqi.last.location)?Geoloqi.last.location.position.longitude:0,"y":(Geoloqi.last&&Geoloqi.last.location)?Geoloqi.last.location.position.latitude:0,"spatialReference":{"wkid":4326}},scalebar:false,overview:false};require(["loqi/map","/js/default-symbols.js","loqi/TripLayer"],function(map,symbols,TripLayer){Geoloqi.trip=new TripLayer(Geoloqi.type,Geoloqi.auth,{map:map,userSymbol:symbols.get("marker-large-blue-user")});dojo.connect(map,"onPanEnd",this,function(){Geoloqi.trip.autofocus=false;});dojo.connect(Geoloqi.trip,"onLocation",Geoloqi.trip,function(){$('#last-point').attr('datetime',this.lastUpdate.date).relative({format:"human",tick:0}).parent().removeClass('hide');$('#speed').text(Math.round(this.lastUpdate.speed)+"kM/h").parent().removeClass('hide');$('time.relative').relative();});if($('#last-point').length>0){$('#last-point').relative({format:"human",tick:0}).parent().removeClass('hide');}
if($("#trip-time-remaining").length>0){$("#trip-time-remaining").relative({format:"%d %DAYS %h %HOURS %m %MINUTES",displayZeros:false});}
if(Geoloqi.type=="trip"){$.getJSON("/platform/share/history.json",{geoloqi_token:Geoloqi.auth,username:Geoloqi.owner},function(history){Geoloqi.trip.updateHistory(history);});}else if(Geoloqi.type=="user"){$.getJSON("/platform/location/history.json",{username:Geoloqi.owner},function(history){Geoloqi.trip.updateHistory(history);});}});